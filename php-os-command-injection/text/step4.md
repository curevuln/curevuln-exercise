## 演習

### アプリケーションの起動

以下のコマンドをターミナルで実行してみましょう。

```bash
docker-compose up
```

### アプリケーションの概要

このアプリケーションはHTMLのページ1つとPHPのスクリプト1つでできています。
HTMLのページではメールアドレスを入力します。
このメールアドレスをPHPのスクリプトに引き渡して処理をします。
ここでは簡単のため、入力されたアドレスをそのまま返す `/bin/echo` コマンドを使っています。
しかしこのコマンドはPHPの`system()`関数を通じてシェルに引き渡されるため、
攻撃例のsendmailと同様の効果を持ちます。

正常動作を試すには`a@b.c`として通常のメールアドレスを入力して「送信します」のボタンをクリックすれば、
「お問い合わせのメールアドレスを出力します: a@b.c」という形で入力内容を返答します。

### 攻撃

1. `https://<擬似ブラウザに表示されているドメイン>//`にアクセスし、メールアドレスの入力欄に`a@b.c; cat /etc/passwd`と入力して、「送信します」のボタンをクリックする。
2. 出力結果にDockerコンテナ中のパスワードファイルの内容が出力されてしまう。

### 攻撃の対策

基本的には、OSコマンドを呼び出さないのが最善の方法です。
どうしても外部から入力された文字列をOSコマンドにシェルのコマンドラインに渡さなければならない場合、
PHPでは、escapeshellarg関数を使い文字列処理をすることで、シェルコマンドをエスケープすることができます。実際は以下のようになります。

```php
system('/bin/echo ' . escapeshellarg($mailaddress));
```

ただし、escapeshellarg関数といえども万全ではないため、保険的対策を併用することを推奨します。

