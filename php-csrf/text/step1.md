### クロスサイトリクエストフォージェリ(CSRF:シーサーフ)とは？

Webアプリケーションには取り消しできない「重要な処理」があります。重要な処理の例としては、物品購入や送金などの際の決済処理、メールの送信やメールアドレスの変更、またパスワードなどユーザ関連情報の変更があります。これらの「重要な処理」の受付に際しては、利用者の意図したリクエストであることを明示的に確認する必要があります。この確認処理が抜けていると、攻撃者が用意した罠サイトなどを利用者のブラウザから閲覧した結果として意図しない「重要な処理」を実行させられる場合があります。このような問題を引き起こす脆弱性をCSRF脆弱性と呼び、CSRF脆弱性を悪用する攻撃をCSRF攻撃といいます。

#### 影響

 - ユーザーの意図しない投稿や購入
 - ユーザーの意図しない重要情報の変更

などが可能になります。

### 攻撃方法
攻撃方法はこのような手順で行います
この攻撃の前提条件として、被害者(ユーザー)は攻撃対象のサイトにすでにログインしていることとします。

1.攻撃者は罠サイトに罠となるHTMLファイルを設置します。
1.ユーザーはこの罠となるファイルをさすURLを閲覧するなどの行為を通じてアクセスをします。
1.利用者はこの罠となるファイルにアクセスすると、攻撃対象のサイトのセッションIDのクッキーをつけて、攻撃対象のサイトにPOSTリクエストを送信します。
1.攻撃対象のサイトは3.で送信されたリクエストを有効なものとして受け取って処理を行った結果、結果としての「重要な処理」が実行されています。

### CSRFと反射型XSSの違い
 - CSRFではセッションIDのクッキー付きで攻撃用リクエストが送られることにより、攻撃対象サイトにあらかじめ用意した処理を不正に実行します。
 - 反射型XSSでは、攻撃用リクエストに含まれるスクリプトがそのままレスポンスとして返り、そのレスポンスがブラウザ上で実行されることで攻撃が成立します。

### 脆弱性が生まれてしまう原因
 - form要素のaction属性にはどのドメインのURLでも指定できるため、罠サイトからでも攻撃対象サイトにリクエストを送信できてしまいます。
 - クッキーに保管されたセッションIDは、罠サイト経由のリクエストに対しても送信されるため、認証された状態で攻撃リクエストを送信できてしまいます。
